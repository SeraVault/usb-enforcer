# Internationalization (i18n) Guide

USB Enforcer supports multiple languages through standard gettext translations.

## For Users

### Setting Your Language

USB Enforcer automatically detects your system language. To test with a specific language:

```bash
LANGUAGE=es /usr/lib/usb-enforcer/.venv/bin/python3 -m usb_enforcer.usb_enforcer_ui
```

### Available Languages

- **English** (en) - Default
- **Spanish** (es) - Complete
- **French** (fr) - Complete

## For Translators

### Creating a New Translation

1. **Extract translatable strings** (maintainers do this):
```bash
cd /path/to/usb-enforcer
./scripts/extract-translations.sh
```

This creates `locale/usb-enforcer.pot` with all translatable strings.

2. **Create translation file** for your language:
```bash
# For French (fr_FR)
msginit -i locale/usb-enforcer.pot -o locale/fr/LC_MESSAGES/usb-enforcer.po -l fr_FR

# For German (de_DE)
msginit -i locale/usb-enforcer.pot -o locale/de/LC_MESSAGES/usb-enforcer.po -l de_DE
```

3. **Translate strings** in the `.po` file:
```po
msgid "Encrypted USB detected"
msgstr "USB chiffré détecté"  # French translation
```

4. **Compile translation**:
```bash
make translations
# Or manually:
msgfmt locale/fr/LC_MESSAGES/usb-enforcer.po -o locale/fr/LC_MESSAGES/usb-enforcer.mo
```

5. **Test your translation**:
```bash
LANGUAGE=fr /usr/lib/usb-enforcer/.venv/bin/python3 -m usb_enforcer.usb_enforcer_ui
```

### Updating Existing Translations

When source code changes add new strings:

1. **Update .pot template**:
```bash
./scripts/extract-translations.sh
```

2. **Merge with existing translation**:
```bash
msgmerge --update locale/es/LC_MESSAGES/usb-enforcer.po locale/usb-enforcer.pot
```

3. **Translate new strings** in the `.po` file

4. **Recompile**:
```bash
make translations
```

## For Developers

### Marking Strings for Translation

Use the `_()` function for simple strings:

```python
from .i18n import _

notification_title = _("Encrypted USB detected")
message = _("Device {device} needs to be unlocked").format(device=dev_name)
```

Use `ngettext()` for plurals:

```python
from .i18n import ngettext

msg = ngettext(
    "This file contains {n} sensitive pattern",
    "This file contains {n} sensitive patterns",
    count
).format(n=count)
```

### Translation Workflow

1. Mark strings with `_()` or `ngettext()`
2. Extract strings: `./scripts/extract-translations.sh`
3. Translators update `.po` files
4. Compile: `make translations`
5. Install: Package includes compiled `.mo` files

### File Structure

```
locale/
├── usb-enforcer.pot          # Template (extracted from source)
├── es/
│   └── LC_MESSAGES/
│       ├── usb-enforcer.po  # Spanish translation source
│       └── usb-enforcer.mo  # Spanish compiled (binary)
└── fr/
    └── LC_MESSAGES/
        ├── usb-enforcer.po  # French translation source
        └── usb-enforcer.mo  # French compiled (binary)
```

### Important Notes

- **Never edit `.mo` files** - they're binary, compiled from `.po` files
- **Always use format strings**, not string concatenation: `_("Hello {name}").format(name=n)`
- **Avoid splitting sentences** across multiple `_()` calls - translators need full context
- **Use descriptive comments** when context is unclear:
```python
# Translators: This appears when USB drive is locked
_("Device {device} needs to be unlocked")
```

## Language Codes

Common ISO 639-1 language codes:

- `en` - English
- `es` - Spanish
- `fr` - French
- `de` - German
- `it` - Italian
- `pt` - Portuguese
- `ru` - Russian
- `zh` - Chinese
- `ja` - Japanese
- `ko` - Korean

With locale variants:
- `es_ES` - Spanish (Spain)
- `es_MX` - Spanish (Mexico)
- `pt_PT` - Portuguese (Portugal)
- `pt_BR` - Portuguese (Brazil)

## Resources

- [GNU gettext manual](https://www.gnu.org/software/gettext/manual/)
- [Python gettext documentation](https://docs.python.org/3/library/gettext.html)
- [Localization guide](https://phrase.com/blog/posts/i18n-a-simple-introduction/)
