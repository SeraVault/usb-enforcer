#!/bin/bash
# USB Enforcer daemon wrapper
set -e

LIBDIR="/usr/lib/usb-enforcer"
VENV="${LIBDIR}/.venv"

# Use venv if available, otherwise use system Python with PYTHONPATH
if [ -d "${VENV}" ] && [ -f "${VENV}/bin/python3" ]; then
    export PYTHONPATH="${LIBDIR}"
    exec "${VENV}/bin/python3" -c "from usb_enforcer.daemon import main; main()" "$@"
else
    export PYTHONPATH="${LIBDIR}"
    exec python3 -c "from usb_enforcer.daemon import main; main()" "$@"
fi
